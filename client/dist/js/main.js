"use strict";$(document).ready(function(){function e(){y=!1,_=0}function t(){$("#advanced").is(":checked")?$("#advanced_report").slideDown():$("#advanced_report").slideUp()}function i(e,t,i){$("#input").slideUp(),$("#report").slideUp(),n(e);var l=i;$("#scan_subject").html("Scanning "+e),$("#progress").html("Getting Servers"),$("#progress").css("width",0),$("#loader").slideDown(),h=[{}],u=0,$.ajax({type:"POST",url:"/api/dns",data:{url:e},dataType:"JSON",success:function(e){function i(i){var a=""+(100-Math.floor((u-1)/p.length*100))+"%";$("#progress").html("Server "+(p.length-u+1)+" of "+p.length),$("#progress").css("width",a),$.ajax({type:"POST",url:"/api/scan",data:{url:e.host,ip:p[i],path:e.path,port:e.port,live_scan:l,advanced:t},dataType:"JSON",timeout:4500,success:n,error:o})}function n(e){e.response||(e.response={}),d(e.response)}function o(e,t,i){d({})}function d(e){u--,h.push(e),2==h.length?r():c(),0==u?a():i(u-1)}return p=e.addresses,u=p.length,0==u?(s(),void a()):void i(u-1)}})}function a(){$("#loader").slideUp(),$("#input").slideDown()}function s(){$("#error").slideDown().delay(1500).slideUp()}function n(e){function t(e,t,i){console.log(i)}$.ajax({type:"POST",url:"/api/query",data:{url:e},dataType:"JSON",timeout:4500,error:t})}function r(){$("#servers").html(""),c(),$("#report").slideDown(),$("#1").click()}function c(){var e=h.length-1;$("#servers").append('<li class="report_button" id="'+e+'"><a>'+p[u]+"</a></li>")}function l(e){function t(e){function t(e){g=e.match(/<(link|img)(link.+href|.+?(data-\w+|src|xlink\:href))=["'](http:[^s]).+?>/gi)||[];for(var t=0;t<g.length;t++)g[t]=g[t].replace(/</gi,"&lt;"),g[t]=g[t].replace(/>/gi,"&gt;");var i=g.length;if($("#insecure_links_left").html(""),i>0){$("#insecure_links_left").html("<p>");for(var t=0;t<i;t++)$("#insecure_links_left").append("<li>"+g[t]+"</li><br>");$("#insecure_links_left").append("</p>"),$("#inseclinks").slideDown()}}function i(e,t,i){console.log(i)}$.ajax({type:"POST",url:"/api/links",data:{name:e},dataType:"JSON",timeout:4500,success:t,error:i})}function i(e,t,i,a){var s=t,n=t?i:a;s?$("#installation_summary").append('<div class="row center"><div class="col-md-5"><h3>'+e+'</h3></div><div class="col-md-2"><span style="color:green; font-weight:600; font-size:3em;"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></span></div><div class="col-md-5 textContainer"><p>'+n+"</p></div></div><hr>"):$("#installation_summary").append('<div class="row center pink-alert"><div class="col-md-5"><h3>'+e+'</h3></div><div class="col-md-2"><span style=" font-weight:600; font-size:3em;"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></span></div><div class="col-md-5 textContainer"><p>'+n+"</p></div></div><hr>")}0==e.url.indexOf("%")&&(e.url=e.url.substring(1)),void 0==e.live?$("#scan_time").html("Scan completed on "+e.scan_time+" after "+e.scan_duration+" seconds. <b>[CACHED COPY]</b>"):$("#scan_time").html("Scan completed on "+e.scan_time+" after "+e.scan_duration+" seconds. "),$("#common_name").text(e.subject.CN||"N/A"),$("#organization").text(e.subject.O||"N/A"),$("#locality").text(e.subject.L||"N/A"),$("#state").text(e.subject.ST||"N/A"),$("#country").text(e.subject.C||"N/A"),$("#ip_address").text(e.ip_address||"N/A"),$("#server_signature").text(e.server||"N/A");var a=!1;try{for(var s="",n=e.san_entries,r=[],c=0;c<n.length;c++)if(0==n[c].indexOf("%")){var l=n[c].substring(1);r[c]=l,n[c]="*."+l}else r[c]=n[c];for(var c=0;c<n.length;c++)s+='<a href="/?url='+r[c]+'">'+n[c]+"</a>, ";s=s.substring(0,s.length-2)+".";for(var c=0;c<n.length;c++)e.url.match(new RegExp("^"+n[c].replace("*.","(.*\\.+)*")+"$","i"))&&(a=!0);a||(s+='<hr /><div class="alert alert-danger" role="alert"><strong><span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span> Certificate Name Mismatch! </strong> '+e.url+" is not a SAN entry.</div>"),$("#san_entries").html(s)}catch(o){$("#san_entries").html("")}var h="EV"==e.cert_type?"glyphicon-star-empty":"OV"==e.cert_type?"glyphicon-ok":"glyphicon-exclamation-sign";$("#cert_type_glyph").removeClass(),$("#cert_type_glyph").addClass("glyphicon "+h),$("#cert_type_text").text(e.cert_type);for(var p="",u=e,v=e,c=0;u;)u!=e&&(p+='<div class="row arrow"><h1><span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span></h1></div>'),p+='<div class="row center"><div class="col-sm-6"><h1>'+(u.subject.O||u.subject.CN)+"</h1><h3>",p+=u==e?"Server Certificate":u.issuerCertificate?"Intermediate Certificate":"Root Certificate",p+='</h3><div class="btn-group" role="group" aria-label="Download/View Certificate"><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#certModal" data-level="'+c+'">&nbsp;View Details&nbsp;</button><a type="button" class="btn btn-primary" href="/api/download?type=crt&id='+u.id+'">Download (PEM)</a><a type="button" class="btn btn-primary" href="/api/download?type=der&id='+u.id+'">Download (DER)</a></div></div><div class="col-sm-6">',p+='<div class="row left"><b><div class="col-xs-4">Common Name: </div><div class="col-xs-8">'+(u.subject.CN||"N/A")+"</div></b></div>",p+='<div class="row left"><div class="col-xs-4">Location: </div><div class="col-xs-8">'+(u.subject.C||"N/A")+"</div></div>",p+='<div class="row left"><div class="col-xs-4">Valid From: </div><div class="col-xs-8">'+(u.valid_from||"N/A")+"</div></div>",p+='<div class="row left"><b><div class="col-xs-4">Valid To: </div><div class="col-xs-8">'+(u.valid_to||"N/A")+"</div></b></div>",p+='<div class="row left"><div class="col-xs-4">Serial No.: </div><div class="col-xs-8">'+(u.serialNumber||"N/A")+"</div></div>",p+='<div class="row left"><b><div class="col-xs-4">Issuer: </div><div class="col-xs-8">'+(u.issuer.CN||"N/A")+"</div></b></div>",p+="</div></div>",v=u,u=u.issuerCertificate,c++;if(e.self_signed){var m='<br><hr/><br><p><strong><div class="alert alert-danger" role="alert"><span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span> ';m+=v==e?"This certificate is self signed and may not be trusted by some browsers.":"The root certificate in this chain is not trusted by some browsers.",p+=m+"</strong></p></div>"}else if(!e.chain_of_trust_complete){var m='<br><hr/><br><div class="alert alert-danger" role="alert">';v.next_cert_id&&(m+='<p class="pull-right"><a href="/api/chain?type=crt&id='+v.next_cert_id+'" class="btn btn-danger">Download the Chain Here</a></p>'),m+='<p><strong>Error! The next certificate in the chain is missing.</strong> The next certificate should be: "'+(v.issuer.CN||"N/A")+'".</p>',p+=m+"</div>"}$("#cert_chain").html(p),t(d),$("#installation_summary").html("");i("Domain Check",a,"<b> "+e.url+' </b>exists in the list of <a id="link_san_entries_section" class="link"><b>SAN entries</b>.<a>',""+e.url+' does not exist in the list of <a id="link_san_entries_section" class="link"><b>SAN entries</b>.<a>');var b=new Date(e.valid_to),y=new Date,_=(b.getTime()-y.getTime())/864e5;i("Certificate Validity",_>=0,"This certificate will expire in <b>"+Math.floor(_)+" days.</b>","This certificate expired "+Math.floor(_*-1)+" days ago."),i("Trusted CA",!e.self_signed,"This Certificate Authority is trusted.",'This Certificate Authority may not be trusted. Check your <a id="link_cert_chain_section" class="link">certificate chain</a> for more information.'),e.self_signed||(i("Certificate Chain",e.chain_of_trust_complete,'This <a id="link_cert_chain_section" class="link"><b>certificate chain</b></a> is complete.','This <a id="link_cert_chain_section" class="link"><b>certificate chain</b></a> is incomplete.'),i("Revocation Status",!e.revoked,"This certificate has not been revoked.","This certificate has been revoked.")),$("#installation_summary hr").last().remove(),f!=$("#url").val()&&(f=$("#url").val(),Cookies.set("recent_url",f)),$("#report_body").fadeIn("slow")}function o(e,t){function i(e){t||("Certificate:"!=e.slice(0,12)?$("#badCert").show():s(e)),t&&("Certificate Request:"!=e.slice(0,20)?$("#badCSR").show():a(e))}function a(e){var t=!1,i=e.replace(/(?:\r\n|\r|\n)/g,"<br />"),a=i.match(/Subject:.*</gi);a=a[0];var s=a.match(/cn=.*?(<|\/|,)/gi),r=a.match(/o=.*?,/gi),c=a.match(/L=.*?(,|\/)/gi),l=a.match(/ST=.*?,/gi),o=a.match(/C=../gi),d=i.match(/DNS:.*?(,|<)/gi);if(d){t=!0;for(var h=n(d),p=0;p<h.length;p++)$("#csr_san").append(h[p]+(p==h.length-1?".":", "))}for(var u=[s,r,c,l,o],v=0;v<u.length;v++)if(null!==u[v]){switch(v){case 0:u[v][0]=u[v][0].slice(3,u[v][0].length-1);break;case 1:u[v][0]=u[v][0].slice(2,u[v][0].length-1);break;case 2:u[v][0]=u[v][0].slice(2,u[v][0].length-1);break;case 3:u[v][0]=u[v][0].slice(3,u[v][0].length-1);break;case 4:u[v][0]=u[v][0].slice(2,u[v][0].length).toUpperCase()}u[v]=u[v][0]}var f=i.indexOf("sha1:")+5,m=i.indexOf("md5")+4,g=i.indexOf("Public-Key: (")+13,b=i.slice(f,f+40),y=i.slice(m,m+32),_=i.slice(g,g+4)+" bits";$("#cn").html(s||"N/A"),$("#o").html(r||"N/A"),$("#loc").html(c||"N/A"),$("#st").html(l||"N/A"),$("#c").html(o||"N/A"),$("#sha1").html(b||"N/A"),$("#md5").html(y||"N/A"),$("#key").html(_||"N/A"),$("#csr_body").html(e.replace(/(?:\r\n|\r|\n)/g,"<br />")),t&&$("#csrSAN").show(),$("#csrBody").show(),$("html, body").animate({scrollTop:$("#csrSummary").offset().top},2e3)}function s(e){var t=e.replace(/(?:\r\n|\r|\n)/g,"<br>"),i=t.slice(t.indexOf("Issuer:"),t.indexOf("Validity")),a=t.match(/Subject:.*?</gi);a=a[0];var s=a.match(/cn=.*?(<|\/|,)/gi);s=s[0];var r=t.indexOf("Not Before:"),c=t.indexOf("Not After :"),l=t.indexOf("Serial")+15,o=i.indexOf("CN"),d=t.indexOf("sha1")+5,h=t.indexOf("md5")+4,p=t.indexOf("Public-Key: (")+13,u=s.slice(3,s.length-1),v=t.slice(r+12,r+36),f=t.slice(c+12,c+36),m=t.slice(l+4,t.indexOf("Signature")),g=i.slice(o+3,i.length),b=t.slice(t.indexOf("Algorithm:")+11,t.indexOf("Issuer:")),y=(t.slice(d,d+40),t.slice(h,h+32),t.slice(p,p+4)+" bits"),_=t.match(/DNS:.*?(,|<)/gi);if(_){var k=n(_);k.map(function(e,t,i){$("#san").append(i[t]+(t==i.length-1?".":", "))})}$("#cn1").html(u),$("#vf").html(v),$("#vt").html(f),$("#sn").html(m),$("#iss").html(g),$("#sa").html(b),$("#pkl").html(y),$("#dCert_body").html(t),$("#certBody").show(),$("html, body").animate({scrollTop:$("#certSummary").offset().top},2e3)}function n(e){var t=e,i=[];return t.map(function(e,t,a){i[t]=a[t].slice(4,a[t].length-1)}),i}function r(e,t,i){console.log(i)}$.ajax({type:"POST",url:"/api/decoder",data:{body:e,csr:t},dataType:"JSON",timeout:4500,success:i,error:r})}var d,h,p,u,v,f,m,g,b=[38,38,40,40,37,39,37,39,66,65],y=!1,_=0;$(document).keydown(function(t){var i=t.keyCode;y||38==i&&(y=!0),y?(b[_]==i?_++:e(),10==_&&(alert("You found it!"),e())):e()}),$("#url").keyup(function(e){13==e.keyCode&&(e.preventDefault(),$("#scan_button").click())}),$("#scan_button").on("click",function(){d=$("#url").val();var e=$("#advanced").is(":checked"),t="/?url="+d;window.history.pushState("string","SSL Scanner: "+d,t),$("#inseclinks").hide(),m=$("#url").val()==Cookies.get("recent_url"),$("#url").val().indexOf(".")==-1?alert("Make sure you have entered a TLD (.com, .net, .org, etc.)"):i(d,e,m)}),$("#live_scan_label").on("click",function(e){e.stopPropagation(),$("#live_scan").prop("checked",!$("#live_scan").prop("checked"))}),$("#advanced_label").on("click",function(e){e.stopPropagation(),$("#advanced").prop("checked",!$("#advanced").prop("checked")),t()}),$("#live_scan").on("click",function(e){e.stopPropagation()}),$("#advanced").on("click",function(e){e.stopPropagation(),t()}),$("#report").on("click",".link",function(){var e=$(this).attr("id").substring(5);$("html, body").animate({scrollTop:$("#"+e).offset().top},1e3)}),$("#certModal").on("show.bs.modal",function(e){for(var t=$(e.relatedTarget),i=parseInt(t.data("level")),a=h[v],s=0;s<i;s++)a=a.issuerCertificate;var n=$(this);n.find(".modal-title").text(a.subject.CN),n.find("#cert_body").html(a.dump.replace(/(?:\r\n|\r|\n)/g,"<br />"))}),$("#refresh").on("click",function(){$("#live_scan").prop("checked",!0),i(d,$("#advanced").is(":checked")),$("#live_scan").prop("checked",!1)}),$("#servers").on("click",".report_button",function(){$("#report_body").hide(),$(".report_button").removeClass("active"),$(this).addClass("active"),v=parseInt($(this).attr("id")),$("#timeout").hide(),Object.keys(h[v]).length>0?l(h[v]):$("#timeout").slideDown()});var k=function(){for(var e={},t=window.location.search.substring(1),i=t.split("&"),a=0;a<i.length;a++){var s=i[a].split("=");if("undefined"==typeof e[s[0]])e[s[0]]=decodeURIComponent(s[1]);else if("string"==typeof e[s[0]]){var n=[e[s[0]],decodeURIComponent(s[1])];e[s[0]]=n}else e[s[0]].push(decodeURIComponent(s[1]))}return e}();k.hasOwnProperty("url")&&(d=k.url,$("#url").val(d),k.hasOwnProperty("advanced")&&"true"==k.advanced&&($("#advanced").prop("checked",!0),t()),i(k.url,"true"==k.advanced)),$("#csr").on("paste",function(){var e=this;setTimeout(function(){var t=($(e).val(),$("#csr").val());t.match(new RegExp(/-----BEGIN/i))?t.match(new RegExp(/REQUEST/i))?$("#csrAlert").slideDown().delay(1500).slideUp():$("#certAlert").slideDown().delay(1500).slideUp():$("#csrFail").slideDown().delay(1500).slideUp()},100)}),$("#decoderSubmit").on("click",function(){$("decodeBody").html("<div></div>");var e,t=$("#csr").val();t.match(/-----BEGIN/i)?e=!!t.match(/REQUEST/i):$("#csrFail").slideDown().delay(1500).slideUp(),$("#csrBody").hide(),$("#certBody").hide(),$("#csr_san").html(" "),$("#san").html(" "),o(t,e)})});